<<<<<<< HEAD
var Portfolio=function(){this.performance=[],this.dateToIndexMap=[];for(var o=0,e=0;e<=30;e++){var t=moment().subtract(30-e,"days");if(0!=t.day()&&6!=t.day()){var r=t.format("YYYY-MM-DD");this.performance[o]={date:r,portfolio:new PortfolioFIFO},this.dateToIndexMap[r]=o,o++}}};Portfolio.prototype={buyStock:function(o,e,t,r){var a=moment(r,"YYYY-MM-DD");if(a.isBefore(this.performance[0].date))for(var i=0;i<this.performance.length;i++)this.performance[i].portfolio.push(o,e,t);else for(var i=0;i<30;i++){var n=a.format("YYYY-MM-DD");n in this.dateToIndexMap&&this.performance[this.dateToIndexMap[n]].portfolio.push(o,e,t),a.add(1,"days")}},sellStock:function(o,e,t){var r=moment(t,"YYYY-MM-DD");if(r.isBefore(this.performance[0].date))for(var a=0;a<this.performance.length;a++)this.performance[a].portfolio.pop(o,e);else for(var a=0;a<this.performance.length;a++){var i=r.format("YYYY-MM-DD");i in this.dateToIndexMap&&this.performance[this.dateToIndexMap[i]].portfolio.pop(o,e),r.add(1,"days")}},cost:function(o){if(o in this.dateToIndexMap){var e=this.performance[this.dateToIndexMap[o]];return e.portfolio.cost()}return console.log("cost(): Oops. Didn't find day in history data ["+o+"]"),0},value:function(o){if(o in this.dateToIndexMap){var e=this.performance[this.dateToIndexMap[o]];return e.portfolio.value()}return console.log("value(): Oops. Didn't find day in history data ["+o+"]"),0},setClosePrice:function(o,e,t){if(t in this.dateToIndexMap){var r=this.performance[this.dateToIndexMap[t]];r.portfolio.setClosePrice(o,e)}else console.log("setClosePrice(): Oops. Didn't find day in history data ["+t+"]")},getHistoryPerformance:function(){this._padMissingDays();for(var o=[],e=0;e<this.performance.length;e++){var t=this.performance[e].portfolio.value(),r=this.performance[e].portfolio.cost();if(t>0&&r>0){var a=100*t/r;o.push(a)}}return o},getPortfolio:function(){return this.performance[this.performance.length-1].portfolio},_padMissingDays:function(){for(var o=this.performance[0].portfolio.getStockAndClose(),e=1;e<this.performance.length;e++){var t=this.performance[e].portfolio,r=t.getStockAndClose();for(var a in r)void 0==r[a]&&a in o&&(r[a]=o[a],t.setClosePrice(a,o[a]));o=r}},_adjustToWeekday:function(o){return 0==o.day()?o.add(1,"days"):6==date.day()&&o.add(2,"days"),o}};
=======
var Portfolio=function(){this.performance=[],this.dateToIndexMap=[];for(var o=0,e=0;30>=e;e++){var t=moment().subtract(30-e,"days");if(0!=t.day()&&6!=t.day()){var r=t.format("YYYY-MM-DD");this.performance[o]={date:r,portfolio:new PortfolioFIFO},this.dateToIndexMap[r]=o,o++}}};Portfolio.prototype={buyStock:function(o,e,t,r){var a=moment(r,"YYYY-MM-DD");if(a.isBefore(this.performance[0].date))for(var i=0;i<this.performance.length;i++)this.performance[i].portfolio.push(o,e,t);else for(var i=0;30>i;i++){var n=a.format("YYYY-MM-DD");n in this.dateToIndexMap&&this.performance[this.dateToIndexMap[n]].portfolio.push(o,e,t),a.add(1,"days")}},sellStock:function(o,e,t){var r=moment(t,"YYYY-MM-DD");if(r.isBefore(this.performance[0].date))for(var a=0;a<this.performance.length;a++)this.performance[a].portfolio.pop(o,e);else for(var a=0;a<this.performance.length;a++){var i=r.format("YYYY-MM-DD");i in this.dateToIndexMap&&this.performance[this.dateToIndexMap[i]].portfolio.pop(o,e),r.add(1,"days")}},cost:function(o){if(o in this.dateToIndexMap){var e=this.performance[this.dateToIndexMap[o]];return e.portfolio.cost()}return console.log("cost(): Oops. Didn't find day in history data ["+o+"]"),0},value:function(o){if(o in this.dateToIndexMap){var e=this.performance[this.dateToIndexMap[o]];return e.portfolio.value()}return console.log("value(): Oops. Didn't find day in history data ["+o+"]"),0},setClosePrice:function(o,e,t){if(t in this.dateToIndexMap){var r=this.performance[this.dateToIndexMap[t]];r.portfolio.setClosePrice(o,e)}else console.log("setClosePrice(): Oops. Didn't find day in history data ["+t+"]")},getHistoryPerformance:function(){this._padMissingDays();for(var o=[],e=0;e<this.performance.length;e++){var t=this.performance[e].portfolio.value(),r=this.performance[e].portfolio.cost();if(t>0&&r>0){var a=100*t/r;o.push(a)}}return o},getPortfolio:function(){return this.performance[this.performance.length-1].portfolio},_padMissingDays:function(){for(var o=this.performance[0].portfolio.getStockAndClose(),e=1;e<this.performance.length;e++){var t=this.performance[e].portfolio,r=t.getStockAndClose();for(var a in r)void 0==r[a]&&a in o&&(r[a]=o[a],t.setClosePrice(a,o[a]));o=r}},_adjustToWeekday:function(o){return 0==o.day()?o.add(1,"days"):6==date.day()&&o.add(2,"days"),o}};
>>>>>>> af9f60cdc553c07cd82b82f84dc93099243270eb
